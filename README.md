<h1 align="center" style="margin-top: 0; margin-bottom: 0;">Apex-Predict-Model<br>Модель прогнозирования квалификационного времени круга гонщика Формулы 1</br></h1>
Проект для предсказания времени круга в Формуле-1 с использованием нейронной сети.
Данный репозиторий содержит в себе модель предсказания квалификационного времени круга гонщика Формулы 1. Полученная модель используется в мобильном приложении <a href="https://github.com/qum11ch/Apex">Apex</a>.


## Описание

Данный репозиторий содержит код для подготовки данных, построения и обучения модели нейронной сети, а также для предсказания времени круга гонщика.

Основные компоненты:

- Загрузка и предобработка данных
- Архитектура нейронной сети
- Обучение и настройка гиперпараметров
- Скрипты для предсказания и анализа результатов

## Собранный датасет

При обучении модели используется собственно собранный датасет. Он собран, основываясь на публичном API [jolpica-f1](https://github.com/jolpica/jolpica-f1), а также на собственных данных. Датасет представляет из себя данные о квалификациях кругах гонщиков с 2018 года, учитывая статистику и погодные условия. *В качестве квалификационного круга, подходящего для записи в датасет, понимается время, вошедшее в 107% от времени лидера*
<br></br><br>В случае, если записанные круги квалификации пришлись на первую гонку в сезоне, то в качестве данных в полях DriverPoints, TeamPoints, DriverAvgQualiPos, TeamAvgQualiPos используются результаты **предыдущего сезона**.</br>

<br>Пример собранного датасета
| Driver | Team     | LapTime | Year | AirTemp | Humidity | Pressure | Rainfall | TrackTemp | DriverPoints | TeamPoints | DriverAvgQualiPos | TeamAvgQualiPos | IsStreetCircuit | F1Era    | CircuitCorners | TrackAirDiff | IsHighHumidity | DriverQualiPace | DriverSeasons | CircuitLength | TeamPointsContribution | Event | CircuitId    | CarEngine |
|--------|----------|---------|------|---------|----------|----------|----------|-----------|--------------|------------|-------------------|-----------------|-----------------|----------|----------------|--------------|----------------|-----------------|---------------|---------------|------------------------|-------|--------------|-----------|
| HAM    | Mercedes | 82.051  | 2018 | 24.9    | 57.6     | 1007.9   | False    | 31.6      | 363.0        | 668.0      | 3.4               | 3.2             | True            | WideAero | 14             | 6.7          | False          | -0.2            | 11            | 5.278         | 0.54                   | Q3    | albert_park  | Mercedes  |
| HAM    | Mercedes | 81.164  | 2018 | 24.5    | 60.5     | 1007.9   | False    | 30.5      | 363.0        | 668.0      | 3.4               | 3.2             | True            | WideAero | 14             | 6.0          | False          | -0.2            | 11            | 5.278         | 0.54                   | Q3    | albert_park  | Mercedes  |
| RAI    | Ferrari  | 82.251  | 2018 | 24.5    | 60.3     | 1007.9   | False    | 30.4      | 205.0        | 522.0      | 3.8               | 3.55            | True            | WideAero | 14             | 5.9          | False          | -0.25           | 15            | 5.278         | 0.39                   | Q3    | albert_park  | Ferrari   |
| RAI    | Ferrari  | 81.828  | 2018 | 24.6    | 60.7     | 1007.9   | False    | 30.5      | 205.0        | 522.0      | 3.8               | 3.55            | True            | WideAero | 14             | 5.9          | False          | -0.25           | 15            | 5.278         | 0.39                   | Q3    | albert_park  | Ferrari   |
| VET    | Ferrari  | 82.085  | 2018 | 24.9    | 59.6     | 1007.9   | False    | 30.2      | 317.0        | 522.0      | 3.3               | 3.55            | True            | WideAero | 14             | 5.3          | False          | 0.25            | 11            | 5.278         | 0.61                   | Q3    | albert_park  | Ferrari   |
| VET    | Ferrari  | 81.838  | 2018 | 24.9    | 60.0     | 1007.9   | False    | 29.9      | 317.0        | 522.0      | 3.3               | 3.55            | True            | WideAero | 14             | 5.0          | False          | 0.25            | 11            | 5.278         | 0.61                   | Q3    | albert_park  | Ferrari   |

<br>Поля датасета представлены ниже
| Поле                     | Описание                                                |
| ------------------------ | ------------------------------------------------------- |
| `Driver`                 | Код гонщика(например, HAM — Lewis Hamilton)    |
| `Team`                   | Название команды гонщика                                |
| `LapTime`                | Время круга в секундах или формате SS.xxx           |
| `Year`                   | Год проведения квалификации                                  |
| `AirTemp`                | Температура воздуха (в градусах Цельсия)                |
| `Humidity`               | Влажность воздуха (%)                                   |
| `Pressure`               | Атмосферное давление (гПа)                              |
| `Rainfall`               | Наличие осадков (True/False)                            |
| `TrackTemp`              | Температура трассы (в градусах Цельсия)                 |
| `DriverPoints`           | Набранные очки гонщиком в сезоне                        |
| `TeamPoints`             | Набранные очки командой в сезоне                        |
| `DriverAvgQualiPos`      | Средняя позиция гонщика в квалификации                  |
| `TeamAvgQualiPos`        | Средняя позиция команды в квалификации                  |
| `IsStreetCircuit`        | Индикатор уличной трассы (True/False)                   |
| `F1Era`                  | Эра Формулы 1 (WideAero, GroundEffect)        |
| `CircuitCorners`         | Количество поворотов на трассе                          |
| `TrackAirDiff`           | Разница температуры воздуха и трассы                    |
| `IsHighHumidity`         | Высокая влажность (True/False)                          |
| `DriverQualiPace`        | Скорость гонщика в квалификации (относительно среднего) |
| `DriverSeasons`          | Количество сезонов гонщика                              |
| `CircuitLength`          | Длина трассы (в километрах)                             |
| `TeamPointsContribution` | Вклад команды в очки сезона                             |
| `Event`                  | Этап гонки (например, Q3 — третья часть квалификации)   |
| `CircuitId`              | Идентификатор трассы                                    |
| `CarEngine`              | Производитель двигателя команды гонщика                                    |

Собранный датасет был очищен от выбросов на целевой переменной (времени круга, она же LapTime) при помощи метода IsolationForest. **Итого: 10728 строк и 25 полей**
<br></br><br>Более подробно создание датасета вы сможете рассмотреть в методе dataset.py</br>
## Структура проекта

- `main.py` — основной модуль для обучения модели на собранном датасете
- `analyse.py` — модуль, осуществляющий анализ собранного датасета (отчистка от выбросов, расчет метрик)
- `predictor.py` — модуль тестового предсказания
- `dataset.py` — модуль, в котором собирается датасет
- `models/` — директория, содержащая полученные модели CatBoost и разработанную модель нейронной сети
- `preprocessors/` — дериктория, содержащая препроцессоры, необходимые для кодирования и масштабирования входных данных
- `tuner_dir/` — дериктори, содержащая результаты подбора гиперпараметров
- `requirements.txt` — список зависимостей


## Установка и запуск

1. Клонируйте репозиторий:

   ```bash
   git clone https://github.com/qum11ch/Apex-Predict-Model.git
   cd Apex-Predict-Model
   ```

2. Создайте виртуальное окружение и активируйте его:

   ```bash
   python -m venv venv
   source venv/bin/activate  # Linux/MacOS
   venv\Scripts\activate   # Windows
   ```

3. Установите зависимости:

   ```bash
   pip install -r requirements.txt
   ```

4. Запустите обучение модели:

   ```bash
   python main.py
   ```

5. Для предсказания используйте:

   ```bash
   python predictor.py
   ```

## Вклад

Если вы хотите внести изменения или улучшения, создайте форк, сделайте изменения и отправьте Pull Request.



## Лицензия

MIT License. Подробнее в файле LICENSE.



## Контакты

Если у вас есть вопросы или предложения, вы можете связаться с автором проекта:

Email: f1.app@mail.ru

Email: sharapatov.n@mail.ru

GitHub: https://github.com/qum11ch


## Отказ от ответственности / Disclaimer

Этот репозиторий является неофициальным и никак не связано с компаниями Формулы-1.  
F1, FORMULA ONE, FORMULA 1, FIA FORMULA ONE WORLD CHAMPIONSHIP, GRAND PRIX и связанные с ними знаки являются торговыми марками Formula One Licensing B.V.

This repository is unofficial and is not associated in any way with the Formula 1 companies.  
F1, FORMULA ONE, FORMULA 1, FIA FORMULA ONE WORLD CHAMPIONSHIP, GRAND PRIX and related marks are trade marks of Formula One Licensing B.V.
